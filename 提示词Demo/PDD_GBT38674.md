## “7. 资源使用安全-文件管理” (讲义P95-97)。

### “错误”的提示：
```text
请用Python写一个文件上传功能。
```
这种模糊的提示很可能导致AI生成不安全的代码，比如未验证文件类型、存在路径遍历风险等。

### “AI驱动的、符合规范”的精确提示：
```markdown
请基于Python Flask框架，编写一个安全的文件上传函数。
## 要求
严格遵循《GB/T 38674》文件管理安全要求，包括但不限于以下几点：
- 文件路径验证：对上传的文件名进行清理，防止路径遍历攻击（如'../'）。
- 文件类型验证：不仅检查文件扩展名，还要读取文件头（Magic Number）来确认文件类型，仅允许上传'.png'和'.jpg'格式的图片。
- 临时文件管理：使用安全的临时文件存储，并确保操作后清理。
- 权限控制：确保上传目录不可执行。
- 请将所有的依赖项写入requirements.txt。
```

### 代码审计提示
```markdown
你是一名资深信息安全专家和代码审计顾问，具备丰富的漏洞识别与修复经验，熟悉包括 Web 安全、系统安全、加密实现、内存安全等多个领域。请对`.\secure_file_upload_demo\`目录下的代码进行深入分析，任务如下：
## 审计目标：
 	- 识别所有可能存在的安全漏洞，包括但不限于：
 	   - 输入验证缺陷（如SQL注入、XSS、命令注入等）
 	   - 权限控制问题（如越权访问、任意文件读写）
 	   - 内存问题（如缓冲区溢出、Use-After-Free）
 	   - 加密错误（如弱加密、不安全随机数、硬编码秘钥）
 	   - 第三方依赖滥用（如不安全调用、版本漏洞）
 	- 对每一个漏洞进行结构化输出，内容包括：
 	   - 漏洞名称
 	   - 漏洞描述
       - 漏洞位置（尽量标明行号、函数或模块名）
      - 风险等级（高 / 中 / 低）
      - 潜在危害/利用方式
      - 详细修复建议（包括代码修改建议、安全加固措施等）
      - 修复后效果说明（说明为何可防止攻击）
## 附加要求：
 	- 如果可行，请参考 OWASP Top 10 / CWE 编号 / CVSS 风险评估。
 	- 若有多个问题，请逐项列出，不要遗漏中低危问题。
 	- 对于每个修复建议，务必给出详细技术细节，可操作示例代码，以及修复前后对比。
请一次性完成全部的审计工作，并以markdown格式生成“安全审计报告.md”文件
```

### 根据代码审计报告迭代优化代码
```markdown
我们对你写的文件进行了安全审计，并在`secure_file_upload_demo`目录中生成了`安全审计报告.md`。请你根据安全审计报告对项目进行改进。 
```

### 复审迭代优化代码
```markdown
我们已经根据安全审计报告进行了项目改进，请按照前述审计需求，对项目重新审计，并生成新的审计报告`安全审计报告(复审).md`。
```